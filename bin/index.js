"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var ttiPolyfill=createCommonjsModule(function(e){!function(){var t="undefined"!=typeof window&&window===this?this:void 0!==commonjsGlobal&&null!=commonjsGlobal?commonjsGlobal:this,n="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)};function o(){o=function(){},t.Symbol||(t.Symbol=i)}var r=0;function i(e){return"jscomp_symbol_"+(e||"")+r++}function a(){o();var e=t.Symbol.iterator;e||(e=t.Symbol.iterator=t.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&n(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return s(this)}}),a=function(){}}function s(e){var n=0;return function(e){return a(),(e={next:e})[t.Symbol.iterator]=function(){return this},e}(function(){return n<e.length?{done:!1,value:e[n++]}:{done:!0}})}function c(e){a();var t=e[Symbol.iterator];return t?t.call(e):s(e)}function u(e){if(!(e instanceof Array)){e=c(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}var f=0;var d="img script iframe link audio video source".split(" ");function l(e,t){for(var n=(e=c(e)).next();!n.done;n=e.next())if(n=n.value,t.includes(n.nodeName.toLowerCase())||l(n.children,t))return!0;return!1}function p(e,t){if(2<e.length)return performance.now();for(var n=[],o=(t=c(t)).next();!o.done;o=t.next())o=o.value,n.push({timestamp:o.start,type:"requestStart"}),n.push({timestamp:o.end,type:"requestEnd"});for(o=(t=c(e)).next();!o.done;o=t.next())n.push({timestamp:o.value,type:"requestStart"});for(n.sort(function(e,t){return e.timestamp-t.timestamp}),e=e.length,t=n.length-1;0<=t;t--)switch(o=n[t],o.type){case"requestStart":e--;break;case"requestEnd":if(2<++e)return o.timestamp;break;default:throw Error("Internal Error: This should never happen")}return 0}function m(e){e=e||{},this.w=!!e.useMutationObserver,this.u=e.minValue||null,e=window.__tti&&window.__tti.e;var t=window.__tti&&window.__tti.o;this.a=e?e.map(function(e){return{start:e.startTime,end:e.startTime+e.duration}}):[],t&&t.disconnect(),this.b=[],this.f=new Map,this.j=null,this.v=-1/0,this.i=!1,this.h=this.c=this.s=null,function(e,t){var n=XMLHttpRequest.prototype.send,o=f++;XMLHttpRequest.prototype.send=function(r){for(var i=[],a=0;a<arguments.length;++a)i[a-0]=arguments[a];var s=this;return e(o),this.addEventListener("readystatechange",function(){4===s.readyState&&t(o)}),n.apply(this,i)}}(this.m.bind(this),this.l.bind(this)),function(e,t){var n=fetch;fetch=function(o){for(var r=[],i=0;i<arguments.length;++i)r[i-0]=arguments[i];return new Promise(function(o,i){var a=f++;e(a),n.apply(null,[].concat(u(r))).then(function(e){t(a),o(e)},function(e){t(e),i(e)})})}}(this.m.bind(this),this.l.bind(this)),function(e){e.c=new PerformanceObserver(function(t){for(var n=(t=c(t.getEntries())).next();!n.done;n=t.next())if("resource"===(n=n.value).entryType&&(e.b.push({start:n.fetchStart,end:n.responseEnd}),w(e,p(e.g,e.b)+5e3)),"longtask"===n.entryType){var o=n.startTime+n.duration;e.a.push({start:n.startTime,end:o}),w(e,o+5e3)}}),e.c.observe({entryTypes:["longtask","resource"]})}(this),this.w&&(this.h=function(e){var t=new MutationObserver(function(t){for(var n=(t=c(t)).next();!n.done;n=t.next())"childList"==(n=n.value).type&&l(n.addedNodes,d)?e(n):"attributes"==n.type&&d.includes(n.target.tagName.toLowerCase())&&e(n)});return t.observe(document,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["href","src"]}),t}(this.B.bind(this)))}function v(e){e.i=!0;var t=0<e.a.length?e.a[e.a.length-1].end:0,n=p(e.g,e.b);w(e,Math.max(n+5e3,t))}function w(e,t){!e.i||e.v>t||(clearTimeout(e.j),e.j=setTimeout(function(){var t=performance.timing.navigationStart,n=p(e.g,e.b);t=(window.a&&window.a.A?1e3*window.a.A().C-t:0)||performance.timing.domContentLoadedEventEnd-t;if(e.u)var o=e.u;else performance.timing.domContentLoadedEventEnd?o=(o=performance.timing).domContentLoadedEventEnd-o.navigationStart:o=null;var r=performance.now();null===o&&w(e,Math.max(n+5e3,r+1e3));var i=e.a;5e3>r-n?n=null:n=5e3>r-(n=i.length?i[i.length-1].end:t)?null:Math.max(n,o),n&&(e.s(n),clearTimeout(e.j),e.i=!1,e.c&&e.c.disconnect(),e.h&&e.h.disconnect()),w(e,performance.now()+1e3)},t-performance.now()),e.v=t)}m.prototype.getFirstConsistentlyInteractive=function(){var e=this;return new Promise(function(t){e.s=t,"complete"==document.readyState?v(e):window.addEventListener("load",function(){v(e)})})},m.prototype.m=function(e){this.f.set(e,performance.now())},m.prototype.l=function(e){this.f.delete(e)},m.prototype.B=function(){w(this,performance.now()+5e3)},t.Object.defineProperties(m.prototype,{g:{configurable:!0,enumerable:!0,get:function(){return[].concat(u(this.f.values()))}}});var h={getFirstConsistentlyInteractive:function(e){return e=e||{},"PerformanceLongTaskTiming"in window?new m(e).getFirstConsistentlyInteractive():Promise.resolve(null)}};e.exports?e.exports=h:window.ttiPolyfill=h}()}),setupString='!function(){"use strict";if("PerformanceObserver"in window){new PerformanceObserver(e=>{for(const n of e.getEntries())if(["first-paint","first-contentful-paint"].includes(n.name)){const e="first-paint"===n.name?"__ttfp":"__ttfcp";window[e]=n.startTime+n.duration}}).observe({entryTypes:["resource","paint"]})}if("PerformanceLongTaskTiming"in window){const e=window.__tti={e:[]};e.o=new PerformanceObserver(n=>{e.e=e.e.concat(n.getEntries())}),e.o.observe({entryTypes:["longtask"]})}!function(){function e(e,t){r||(r=t,o=e,c=new Date,i(removeEventListener),n())}function n(){0<=o&&o<c-a&&(s.forEach(function(e){e(o,r)}),s=[])}function t(n){if(n.cancelable){var t=(1e12<n.timeStamp?new Date:performance.now())-n.timeStamp;"pointerdown"==n.type?function(n,t){function i(){e(n,t),o()}function r(){o()}function o(){removeEventListener("pointerup",i,f),removeEventListener("pointercancel",r,f)}addEventListener("pointerup",i,f),addEventListener("pointercancel",r,f)}(t,n):e(t,n)}}function i(e){["click","mousedown","keydown","touchstart","pointerdown"].forEach(function(n){e(n,t,f)})}var r,o,c,s=[],f={passive:!0,capture:!0},a=new Date;i(addEventListener),self.perfMetrics=self.perfMetrics||{},self.perfMetrics.onFirstInputDelay=function(e){s.push(e),n()}}()}();\n';const setup=setupString,measure=async()=>!window||"addEventListener"in window?Promise.resolve({}):new Promise(e=>{window.addEventListener("load",()=>{setTimeout(async()=>{const t=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance;if(!t)return;const n=t.timing;if(!n)return;const{navigationStart:o,unloadEventStart:r,unloadEventEnd:i,redirectStart:a,redirectEnd:s,fetchStart:c,domainLookupStart:u,domainLookupEnd:f,connectStart:d,connectEnd:l,secureConnectionStart:p,requestStart:m,responseStart:v,responseEnd:w,domLoading:h,domInteractive:y,domContentLoadedEventStart:b,domContentLoadedEventEnd:g,domComplete:E,loadEventStart:S,loadEventEnd:L}=n,P=await new Promise(e=>{perfMetrics||e(null),perfMetrics.onFirstInputDelay(t=>e(t))}),T=await ttiPolyfill.getFirstConsistentlyInteractive(),{__ttfp:x=null,__ttfcp:_=null}=window;e(Object.assign({},n,{firstInputDelay:P,ttci:T,ttfp:x,ttfcp:_,domContentLoaded:g-c,domProcessingTime:E-h,pageLoad:L-c,dnsLookupTime:f-u,redirectTime:s-a,tcpConnectionTime:l-d,ttfb:v-m,responseProcessingTime:w-v}))},0)})});exports.setup=setup,exports.measure=measure;
